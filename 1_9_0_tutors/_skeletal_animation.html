<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Urho3D: Skeletal animation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Urho3D
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Skeletal animation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a> component renders GPU-skinned geometry and is capable of skeletal animation. When a model is assigned to it using <a class="el" href="class_urho3_d_1_1_animated_model.html#a67a9794df35c334b050f689bb706847a">SetModel()</a>, it creates a bone node hierarchy under its scene node, and these bone nodes can be moved and rotated to animate.</p>
<p >There are two ways to play skeletal animations:</p>
<ul>
<li>Manually, by adding or removing animation states to the <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a>, and advancing their time positions &amp; weights, see <a class="el" href="class_urho3_d_1_1_animated_model.html#a849cb76532b41588869360da17a823c9">AddAnimationState()</a>, <a class="el" href="class_urho3_d_1_1_animated_model.html#a1cebe66b30f1051b0c652e4d5de356d8">RemoveAnimationState()</a>, <a class="el" href="class_urho3_d_1_1_animation_state.html#a7ae6a442fb5681d75cefe81ebbad19e8">AddTime()</a> and <a class="el" href="class_urho3_d_1_1_animation_state.html#a249563003fdad42c1333c702c456fb7a">SetWeight()</a>.</li>
<li>Using the <a class="el" href="class_urho3_d_1_1_animation_controller.html" title="Component that drives an AnimatedModel&#39;s animations.">AnimationController</a> helper component: create it into the same scene node as the <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a>, and use its functions, such as <a class="el" href="class_urho3_d_1_1_animation_controller.html#a5d1adceee492a37666943e3ed92fd55a">Play()</a> and <a class="el" href="class_urho3_d_1_1_animation_controller.html#ae3cff7fdd6c930d7e05238ed09e4d4f1">Stop()</a>. <a class="el" href="class_urho3_d_1_1_animation_controller.html" title="Component that drives an AnimatedModel&#39;s animations.">AnimationController</a> will advance the animations automatically during scene update. It also enables automatic network synchronization of animations, which the <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a> does not do on its own.</li>
</ul>
<p >Note that <a class="el" href="class_urho3_d_1_1_animation_controller.html" title="Component that drives an AnimatedModel&#39;s animations.">AnimationController</a> does not by default stop non-looping animations automatically once they reach the end, so their final pose will stay in effect. Rather they must either be stopped manually, or the <a class="el" href="class_urho3_d_1_1_animation_controller.html#a8ae79e48a4111a65e8a22f821df4f03c">SetAutoFade()</a> function can be used to make them automatically fade out once reaching the end.</p>
<h1><a class="anchor" id="SkeletalAnimation_Blending"></a>
Animation blending</h1>
<p >Animation blending uses the concept of numbered layers. Layer numbers are unsigned 8-bit integers, and the active <a class="el" href="class_urho3_d_1_1_animation_state.html">AnimationStates</a> on each layer are processed in order from the lowest layer to the highest. As animations are applied by lerp-blending between absolute bone transforms, the effect is that the higher layer numbers have higher priority, as they will remain in effect last.</p>
<p >By default an <a class="el" href="class_urho3_d_1_1_animation.html" title="Skeletal animation resource.">Animation</a> is played back by using all the available bone tracks. However an animation can be only partially applied by setting a start bone, see <a class="el" href="class_urho3_d_1_1_animation_state.html#a73efb90d9d6a41debe30e4d151a50e85">SetStartBone()</a>. Once set, the bone tracks will be applied hierarchically starting from the start bone. For example, to apply an animation only to a bipedal character's upper body, which is typically parented to the spine bone, one could set the spine as the start bone.</p>
<p >It is also possible to enable additive (difference) blending mode on an animation, by using <a class="el" href="class_urho3_d_1_1_animation_state.html#acd96350691fd4daa46a57363b2c57561">SetBlendMode()</a> with the ABM_ADDITIVE parameter. In this mode the <a class="el" href="class_urho3_d_1_1_animation_state.html" title="Animation instance.">AnimationState</a> applies a difference of the animation pose to the model's base pose, instead of straightforward lerp blending. This allows an animation to be applied "on top" of the other animations, but the end result can be unpredictable in case of large difference from the base pose. Additive animations should reside on higher priority layers than lerp blended animations or otherwise the lerp blending will "blend out" the additive animation.</p>
<h1><a class="anchor" id="SkeletalAnimation_Triggers"></a>
Animation triggers</h1>
<p >Animations can be accompanied with trigger data that contains timestamped <a class="el" href="class_urho3_d_1_1_variant.html" title="Variable that supports a fixed set of types.">Variant</a> data to be interpreted by the application. This trigger data is in XML format next to the animation file itself. When an animation contains triggers, the <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a>'s scene node sends the E_ANIMATIONTRIGGER event each time a trigger point is crossed. The event data contains the timestamp, the animation name, and the variant data. Triggers will fire when the animation is advanced using <a class="el" href="class_urho3_d_1_1_animation_state.html#a7ae6a442fb5681d75cefe81ebbad19e8">AddTime()</a>, but not when setting the absolute animation time position.</p>
<p >The trigger data definition is below. Either normalized (0 = animation start, 1 = animation end) or non-normalized (time in seconds) timestamps can be used. See bin/Data/Models/Ninja_Walk.xml and bin/Data/Models/Ninja_Stealth.xml for examples; NinjaSnowWar implements footstep particle effects using animation triggers.</p>
<div class="fragment"><div class="line">&lt;animation&gt;</div>
<div class="line">    &lt;trigger time=<span class="stringliteral">&quot;t&quot;</span> normalizedtime=<span class="stringliteral">&quot;t&quot;</span> type=<span class="stringliteral">&quot;Int|Bool|Float|String...&quot;</span> value=<span class="stringliteral">&quot;x&quot;</span> /&gt;</div>
<div class="line">    &lt;trigger ... /&gt;</div>
<div class="line">&lt;/animation&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="SkeletalAnimation_ManualControl"></a>
Manual bone control</h1>
<p >By default an <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a>'s bone nodes are reset on each frame, after which all active animation states are applied to the bones. This mechanism can be turned off per-bone basis to allow manual bone control. To do this, query a bone from the <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a>'s skeleton and set its <a class="el" href="struct_urho3_d_1_1_bone.html#a81a1ce6f32473a71fe072911cc07e167">animated_</a> member variable to false. For example:</p>
<div class="fragment"><div class="line">Bone* headBone = model-&gt;GetSkeleton().GetBone(<span class="stringliteral">&quot;Bip01_Head&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (headBone)</div>
<div class="line">    headBone-&gt;animated_ = <span class="keyword">false</span>;</div>
</div><!-- fragment --><h1><a class="anchor" id="SkeletalAnimation_CombinedModels"></a>
Combined skinned models</h1>
<p >To create a combined skinned model from many parts (for example body + clothes), several <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a> components can be created to the same scene node. These will then share the same bone nodes. The component that was first created will be the "master" model which drives the animations; the rest of the models will just skin themselves using the same bones. For this to work, all parts must have been authored from a compatible skeleton, with the same bone names. The master model should have all the bones required by the combined whole (for example a full biped), while the other models may omit unnecessary bones. Note that if the parts contain compatible vertex morphs (matching names), the vertex morph weights will also be controlled by the master model and copied to the rest.</p>
<h1><a class="anchor" id="SkeletalAnimation_NodeAnimation"></a>
Node animations</h1>
<p >Animations can also be applied outside of an <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a>'s bone hierarchy, to control the transforms of named nodes in the scene. The AssetImporter utility will automatically save node animations in both model or scene modes to the output file directory.</p>
<p >Like with skeletal animations, there are two ways to play back node animations:</p>
<ul>
<li>Instantiate an <a class="el" href="class_urho3_d_1_1_animation_state.html" title="Animation instance.">AnimationState</a> yourself, using the constructor which takes a root scene node (animated nodes are searched for as children of this node) and an animation pointer. You need to manually advance its time position, and then call <a class="el" href="class_urho3_d_1_1_animation_state.html#ae662a588f71a9adfb4aea3162bb2a742">Apply()</a> to apply to the scene nodes.</li>
<li>Create an <a class="el" href="class_urho3_d_1_1_animation_controller.html" title="Component that drives an AnimatedModel&#39;s animations.">AnimationController</a> component to the root scene node of the animation. This node should not contain an <a class="el" href="class_urho3_d_1_1_animated_model.html" title="Animated model component.">AnimatedModel</a> component. Use the <a class="el" href="class_urho3_d_1_1_animation_controller.html" title="Component that drives an AnimatedModel&#39;s animations.">AnimationController</a> to play back the animation just like you would play back a skeletal animation.</li>
</ul>
<p >Node animations do not support blending, as there is no initial pose to blend from. Instead they are always played back with full weight. Note that the scene node names in the animation and in the scene must match exactly, otherwise the animation will not play. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Dec 10 2022 04:54:52 for Urho3D by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
