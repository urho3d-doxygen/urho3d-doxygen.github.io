<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Urho3D: Database</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Urho3D
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="class_urho3_d_1_1_database.html" title="Database subsystem. Manage database connections.">Database</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The <a class="el" href="class_urho3_d_1_1_database.html" title="Database subsystem. Manage database connections.">Database</a> subsystem is built into the Urho3D library only when one of these two <a class="el" href="_building.html#Build_Options">build options</a> are enabled: URHO3D_DATABASE_ODBC and URHO3D_DATABASE_SQLITE. When both options are enabled then URHO3D_DATABASE_ODBC takes precedence. These build options determine which database API the subsystem will use. The ODBC DB API is more suitable for native application, especially the game server, where it allows the app to establish connection to any ODBC compliant databases like SQLite, MySQL/MariaDB, PostgreSQL, Sybase SQL, Oracle, etc. The SQLite DB API, on the other hand, is suitable for mobile application which embeds the SQLite database and its engine into the app itself. The <a class="el" href="class_urho3_d_1_1_database.html" title="Database subsystem. Manage database connections.">Database</a> subsystem wraps the underlying DB API using a unified URHO3D API, so no or minimal code changes are required to the library user when switching between these two build options.</p>
<p >Currently the implementation just supports immediate SQL statement execution. Prepared statements and transaction management will be added later when the need arises. The subsystem has a simple database connection pooling capability. This internal database connection pool should not be confused with ODBC connection pool option when ODBC DB API is being used. The internal pooling is enabled by default, except when ODBC DB API is being used and when ODBC driver manager 3.0 or later is being detected in the host system, in which case the ODBC connection pool option should be used instead to manage the database connection pooling.</p>
<h1><a class="anchor" id="Establish_DbConnection"></a>
Establishing database connection</h1>
<p >A new database connection is established by calling <a class="el" href="class_urho3_d_1_1_database.html#a4980c596766d67ebbce39877ede3adf4">Connect()</a> and passing it with a so-called database connection string. The database connection string does not only identify which database to connect to, but also other relevant database connection settings like: database user id, user password, host, and port number, etc. The format of the database connection string is controlled by the underlying DB API. In general the connection string is really the only thing that need to be changed when switching the underlying DB API and when switching the databases to connect to.</p>
<p >When the connection is successfully established, a valid <a class="el" href="class_urho3_d_1_1_db_connection.html" title="Database connection.">DbConnection</a> object is returned. After done with the database connection, an application should disconnect the database connection by calling the <a class="el" href="class_urho3_d_1_1_database.html#a21c72ab60d3acd860fc11c9bcfb226a5">Disconnect()</a>. This is a good practise. When the Urho3D game engine exits, the destructor of the database subsystem automatically disconnects all the still active database connections.</p>
<h2><a class="anchor" id="ODBC_ConnString"></a>
ODBC connection string</h2>
<p >The exact format of the ODBC connection string depends on the ODBC driver for a specific database vendor. Consult the accompanying documentation of the specific ODBC driver on how to construct the database connection string. Both DSN and DSN-less connection string are supported. For the purpose of illustration, this subsection will just explain how to connect to a MySQL/MariaDB database as an example. The MySQL/MariaDB database server is assumed to be running on a localhost on a default port with database name called 'test', and user id &amp; password are "testuser" &amp; "testpassword".</p>
<h3><a class="anchor" id="DSN_ConnString"></a>
DSN connection string</h3>
<p >Use the GUI tool provided by host system to define the ODBC data source. It can be user DSN or system DSN. On Linux host system, simply add the new data source entry in the '~/.odbc.ini' or '/etc/odbc.ini', respectively. Create the file if it does not exist yet. The data source entry must at least contains the following information. </p><pre class="fragment"># These settings assume the host system uses unixODBC as ODBC driver manager
# Settings for iODBC driver manager would be slightly different
[testDSN]
Driver=MariaDB      # This is the name of the ODBC driver installed in the /etc/odbcinst.ini
Description=MariaDB test database
Server=localhost
Port=
User=testuser
Password=testpassword
Database=test
Option=3
Socket=
</pre><p >To connect to this data source, use the following connection string: </p><pre class="fragment">DSN=testDSN
</pre><h3><a class="anchor" id="DSN_less_ConnString"></a>
DSN-less connection string</h3>
<p >To connect to the same database above without pre-configuring it as an ODBC data source, use the connection string like this: </p><pre class="fragment">Driver=MariaDB;Database=test;User=testuser;Password=testpassword;Option=3
</pre><h2><a class="anchor" id="SQLite_ConnString"></a>
SQLite connection string</h2>
<p >The SQLite database is a single disk file. The SQLite connection string is simply a path to the location of that single disk file. Both absolute and relative paths work. When the path is valid but the disk file does not exist yet then SQLite database engine will automatically create the disk file and hence create a new empty database in the process. The drawback with this approach is, there is no way to pass additional database connection settings. In order to do that, SQLite DB API also supports connection string using RFC 3986 URI format. Consult SQLite documentation on <a href="https://www.sqlite.org/uri.html">URI format</a> for more detail. For illustration purposes, this subsection will assume the SQLite disk file is called 'test.db' located in home directory and current working directory is home directory.</p>
<h3><a class="anchor" id="Path_ConnString"></a>
Path connection string</h3>
<p >With the above assumption, the following example connection strings work equally.</p>
<p >Relative path: </p><pre class="fragment">test.db
</pre><p >Or absolute path: </p><pre class="fragment">/home/testuser/test.db
</pre><h3><a class="anchor" id="URI_ConnString"></a>
URI connection string</h3>
<p >In this format the additional database connection setting can be passed as query parameters. As an example, to connect to the same database as above but in read-only and shared-cache mode then the connection string can be rewritten as: </p><pre class="fragment">file:./test.db?mode=ro&amp;cache=shared
</pre><p >Or: </p><pre class="fragment">file:///home/testuser/test.db?mode=ro&amp;cache=shared
</pre><h1><a class="anchor" id="Immediate_Execution"></a>
Immediate SQL statement execution</h1>
<p >Use the <a class="el" href="class_urho3_d_1_1_db_connection.html#aa8757dfc41b4d7cf9158f88d7a4df7b2">Execute()</a> to execute an SQL statement in immediate mode. In immediate mode, the SQL statement is opened, prepared, executed, and finalized in one go. It is a convenient method to perform adhoc query but it may not be good for system performance when a same query is being performed repeatedly. The method returns a <a class="el" href="class_urho3_d_1_1_db_result.html" title="Database query result.">DbResult</a> object regardless of whether the query type is DML (Data Manipulation Language) or DDL (Data Definition Language). The DbResult object only contains the resultset when the SQL statement being executed is a select query. Use the <a class="el" href="class_urho3_d_1_1_db_result.html#aea33fffd8278e21ec4916cb5021ea8a9">GetNumColumns()</a> and <a class="el" href="class_urho3_d_1_1_db_result.html#a7fe6ce7d585ee1dded6f08d8e3e748dd">GetNumRows()</a> to find out the size of the resultset. Use the <a class="el" href="class_urho3_d_1_1_db_result.html#aebdda00ff3a5d0d2b848edb2e0001477">GetColumns()</a> and <a class="el" href="class_urho3_d_1_1_db_result.html#abbd67b8939deddf1a6b069f3e5e310ad">GetRows()</a> to get the actual column headers data and rows data, respectively. For DML statement, use the <a class="el" href="class_urho3_d_1_1_db_result.html#a700dd88db1a1eed9918b0b7f672ab0dd">GetNumAffectedRows()</a> to find out the number of affected rows.</p>
<p >The number of rows in the DbResult object may be less than the actual number of rows being fetched from the database. This is because the fetched rows could be instructed to be filtered out by <a class="el" href="_database.html#DB_Cursor">E_DBCURSOR</a> event handler. The whole rows fetching process could also be aborted upon request of E_DBCURSOR event handler.</p>
<h1><a class="anchor" id="Prepare_Bind_Execution"></a>
SQL execution using prepared statements and dynamic parameter bindings</h1>
<p >Not yet supported at this moment.</p>
<h1><a class="anchor" id="Transaction_Management"></a>
Transaction Management</h1>
<p >Not yet supported at this moment. Currently all statements are auto-committed unless the database is connected as read-only (in which case DML and DDL statements would cause an error to be logged).</p>
<h1><a class="anchor" id="DB_Cursor"></a>
Database cursor event</h1>
<p >When executing an SQL statement there is an option to enable the sending of database cursor event. This event is sent on each row in the resultset as it is being fetched. i.e. the events could be sent multiple times before the Execute() method returns. Application can subscribe to this event to influence how the resultset is being populated in the DbResult object.</p>
<p >The E_DBCURSOR has input and output parameters.</p>
<p >Output parameters: </p><pre class="fragment">P_SQL        SQL query string currently being executed (String)
P_NUMCOLS    Number of columns in the resultset (unsigned)
P_COLHEADERS Column headers in the resultset (StringVector)
P_COLVALUES  Row data as it is being fetched (VariantVector)
</pre><p >Input parameters: </p><pre class="fragment">P_FILTER     Set to true to filter out this row from the DbResult object
P_ABORT      Set to true to abort further fetching process
</pre><p >The P_FILTER could be used for any additional client-side filtering logic that is otherwise difficult to be carried out at the database server-side using WHERE or HAVING clause. The P_ABORT when used does not affect rows that are already populated into DbResult object. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Dec 10 2022 04:54:52 for Urho3D by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
