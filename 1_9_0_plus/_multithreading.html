<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Urho3D: Multithreading</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Urho3D
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Multithreading </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Urho3D uses a task-based multithreading model. The <a class="el" href="class_urho3_d_1_1_work_queue.html" title="Work queue subsystem for multithreading.">WorkQueue</a> subsystem can be supplied with tasks described by the <a class="el" href="struct_urho3_d_1_1_work_item.html" title="Work queue item.">WorkItem</a> structure, by calling <a class="el" href="class_urho3_d_1_1_work_queue.html#ab717544bbd92f6bece773423b50a13f3">AddWorkItem()</a>. These will be executed in background worker threads. The function <a class="el" href="class_urho3_d_1_1_work_queue.html#ae806e307f90b458bf86be68ec4648089">Complete()</a> will complete all currently pending tasks, and execute them also in the main thread to make them finish faster.</p>
<p >On single-core systems no worker threads will be created, and tasks are immediately processed by the main thread instead. In the presence of more cores, a worker thread will be created for each hardware core except one which is reserved for the main thread. Hyperthreaded cores are not included, as creating worker threads also for them leads to unpredictable extra synchronization overhead.</p>
<p >The work items include a function pointer to call, with the signature</p>
<pre class="fragment">void WorkFunction(const WorkItem* item, unsigned threadIndex)
</pre><p >The thread index ranges from 0 to n, where 0 represents the main thread and n is the number of worker threads created. Its function is to aid in splitting work into per-thread data structures that need no locking. The work item also contains three void pointers: start, end and aux, which can be used to describe a range of sub-work items, and an auxiliary data structure, which may for example be the object that originally queued the work.</p>
<p >Multithreading is so far not exposed to scripts, and is currently used only in a limited manner: to speed up the preparation of rendering views, including lit object and shadow caster queries, occlusion tests and particle system, animation and skinning updates. Raycasts into the <a class="el" href="class_urho3_d_1_1_octree.html" title="Octree component. Should be added only to the root scene node.">Octree</a> are also threaded, but physics raycasts are not. Additionally there are dedicated threads for audio mixing and background loading of resources.</p>
<p >When making your own work functions or threads, observe that the following things are unsafe and will result in undefined behavior and crashes, if done outside the main thread:</p>
<ul>
<li>Modifying scene or UI content</li>
<li>Modifying GPU resources</li>
<li>Executing script functions</li>
<li>Pointing <a class="el" href="class_urho3_d_1_1_shared_ptr.html" title="Shared pointer template class with intrusive reference counting.">SharedPtr</a>'s or <a class="el" href="class_urho3_d_1_1_weak_ptr.html" title="Weak pointer template class with intrusive reference counting. Does not keep the object pointed to al...">WeakPtr</a>'s to the same <a class="el" href="class_urho3_d_1_1_ref_counted.html" title="Base class for intrusively reference-counted objects. These are noncopyable and non-assignable.">RefCounted</a> object from multiple threads simultaneously</li>
</ul>
<p >Using the <a class="el" href="class_urho3_d_1_1_profiler.html" title="Hierarchical performance profiler subsystem.">Profiler</a> is treated as a no-op when called from outside the main thread. Trying to send an event or get a resource from the <a class="el" href="class_urho3_d_1_1_resource_cache.html" title="Resource cache subsystem. Loads resources on demand and stores them for later access.">ResourceCache</a> when not in the main thread will cause an error to be logged. Log messages from other threads are collected and handled in the main thread at the end of the frame. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 9 2022 22:07:56 for Urho3D by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
